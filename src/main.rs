use codec::{Decode, Encode};
use frame_support::{RuntimeDebug};
use scale_info::TypeInfo;
use sp_finality_grandpa::{AuthorityId, AuthoritySignature};
use sp_runtime::traits::Header as HeaderT;
use sp_runtime::{
    generic,
    traits::{BlakeTwo256},
};
use hex_literal::hex;

// Rococo settings
pub type BlockNumber = u32;
pub type Hasher = BlakeTwo256;
pub type Header = generic::Header<BlockNumber, Hasher>;

#[derive(Encode, Decode, RuntimeDebug, TypeInfo, Clone, PartialEq, Eq)]
pub struct GrandpaJustification<Header: HeaderT> {
    pub round: u64,
    pub commit:
        finality_grandpa::Commit<Header::Hash, Header::Number, AuthoritySignature, AuthorityId>,
    pub votes_ancestries: Vec<Header>,
}


fn main() {
    // scale encoded justification, received via @polkadot/api justification listener. Block: 0x6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d7
    let hex: Vec<u8> = hex!("6f000000000000006bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00c86bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00e934b38537d15b2c5d91a937dc5fb7471610efab5472d7342a5d6218196d70f44f7647d29889bd390a45ae703cb499887bf0d24a25b24d2322ace44ead9cf00301be210c41640973e910c6ced80cb97aac362bd9d376fc10f60812bd900799236bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00bf05eb66a1c84b30599efc7f005d69fce9c305728408221abab6b5d36b19f0cfb968fbce6646e950e616bed879880c3cf2ddf53332065762c68ea52a081c9806038893749e3cf628920efc22288ecec8925e3b48eea5c76c8cda4363f8bf6c3d6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00c51c85150cdfb81eac96ba2475a97c3acf2c5c28afbb80c1a47cd4a28dfefff2bc7b143e7a28c919788cc838e14b274034a122c2b417d3af135e1c932120160d06f701aca4040aedcd0b137e6f1b0d4dc398dda41d305c32101bd1bc5dcfe0676bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00f59f0c7609ccefb1cec40cfbebbc8e91f35c9efd7e28cf037647ffeaae98be05c17348ba400b56904f50ebd50d02eb0f588ab7932c035a2a3cfd649a9bf7280609b0d2a995e691b7893a42511eed8b428b8f174c7cdb4c26991f15e275d5640a6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c000befe348c96dc3caae07ddce18eef570cc9d9b24ad7fdf68b79c1cae90de90bc13eb2bb6400e7b6cdda60c85ce22065a819f50aa5cb6e2f993a75874227997030bdccf9a98e20c8969f0bc1ecb40fed9d915665a398756df15ad42ce42dfdaa76bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00b38f2bb1397aba865322c2ace2c6e75ee94a39e27b20dd525200d4a963c32c86298c5e6438805a35b0043c4a72dce3a473a9b8c994d9faa915571f78a1268b040c2fc28e2f7d2d3779e4caabeb9a807507d57b11adbbe9aee5aa3cb550e81ba56bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c001474fd1f1e40b8dea1c4c47fce21025676b843dd2206bd932f9ef9cb4ffc20b2db3824930d728ef8e7e9e7a099d294f4f3bd1bca980dbdd0c25bd38e42fef0020e3306f44f1e7e34583f383e3f39c9aedc6022d252fe418a54d261682411397c6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0050bce54a53bb6439d1b96df4c1128217d9cd04a13c67cd64ea7237ccd724e70e5570782bcf6bb8b6931e740667f7395773b2e3e7c486842d48b32c59d07929002f5b0b76bc1fab80027d3ef266d58fed4482fcc07cdef3f72ce5ef4ce3dd4b956bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c002e0df4a679e81221a23ba3d2a3dc112ef01de568d014a156a7245bb2a56e7cfa7c399a204e126648fac64a5ce9969cd13bf2d6d3ab5b96d154b0e5887150d80c3387b7d8d34e4ac89a48684e595b8f5505b26015ad6ffecb8a66591a4b2589496bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00d89b7b8cee76c2d9055fa1943b8905446d7f6670d3a9d28d0f2f8c26683b76f7c15b94379949fcbe5765ac6950f1cdb0281be4cada230b3052a820314dc9c80f478e61a5080684faecb7ef99c60860da4effcf4ae4431c39fa1815fd62302c116bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00da7390fe96fe14e3bfc73c8659d95811eed0d43e7c6a567e06fb673ac37478abde8493facb7390055ff42852694ca59fbfb70b6e0f2c00c9fc2ca5e71b4e880a4bea0b37e0cce9bddd80835fa2bfd5606f5dcfb8388bbb10b10c483f0856cf146bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00ff498bb21a38f78b36da31879024db2ef1f7f39394df13b75f981321e99d7989ff5dabf29655e64ca6b54a2fb689b16d530d328d91bd14a766da7974ad3a0c044ee66173993dd0db5d628c4c9cb61a27b76611ad3c3925947f0d0011ee2c5dcc6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c006810dbdb527596be10a453305f8ec53d30b6ca31aa689adfad11290656e5e049f08dc8945084ac71a7309b57bbfe2106e9c47d410340dcb2b0035e29c4a01d0654c25d6d021fae256d6a9fc7a0dc66b2b8c75816d538afa409a3f7e97f00f30b6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c008ef702ff239e20f9f7a8100feba858afdc287fb6f0b3cbf46e17d6af18672272c153654a42ac94d56e6f7ed712c4059bb85ef972e25e64b5cc7a9b72783f0f0c54d8e2f18edd97ead7fdb635b69dad6fb4585624275eee2aca1f387d22087a686bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0081c6ab6636ece3363a4b80e41c0317608e6ac9a8473f9a1b09beccc60517ae800484f53c6325319926aaa3b2e57935a0e5138f9784edc7bb5217015d7ef4000055107b850415e4ffa078e7232fcfaa677173c6db30efc0b2b2c095a4dbd10f836bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00afdc287d6df5740bba60f37f79eaabbcc8d9a812a6eb39310a622a5f832a0e2cb2de0d0b21e26d62743918ba581159643321adb3acb33948377c16ec00b5140b5a9b75fd47b5ed526b60a6502ab5749b2f753c4abf945bf651799a46e5f664a66bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00fbce056d681a1775c78702036af8ddf5532d919903cc619a3e123590075caa2ad8d258e205e8ae467409ce7a3302b4ee2de99b6f779d30aca0b48b356726fb045af8b039c6cbb75b477d4971b72bb1ddd1426cc9a41a0fffade840b26e4708256bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00810057730c5710de4842068e3ff8b2f656b967499704395f3fdaa14f65535725e2d88aee86dd2a5b3b36d83a48938dd227dde1a6de95f452cf26723684c03b09608e52448ab3e3c0184e9c1e86bb4d8663070e3e1011a2486b9c06268d1b792e6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00a9d52ed47a9c4b2df079712379e8c7ca61f53143c62b5004151f0d62db62a237ff2dc82c305c57afa6e019ec020492e075c9f5c618dce381f5dea9c08284920168b1048d69ecb0e9fcc1134594fd992a8acfba224390d89869dfadf4a410d0126bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00a0b55849ca4924d137cb965e7a12cf3c22ba1edb6a0ce519afab0e9d249d0cdbc5f691fcef47c53b549075c8a6a2d0dfb050779c405dffa32b506c75b874f5096c878e33b83c20324238d22240f735457b6fba544b383e70bb62a27b57380c816bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c000516c4dd0554f9760a0eb5214f7d0b2d77bf90b474d6bd37e61783cead6549e1cebd41caa53aa09785433f646a77cf16924d4e5ad295e00201fd0da723e13e0d6c9a4e41566b92c5c62ddeb6bf008a18c1cef7bbd8aa8f89a215d736e525f5716bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c004576d49d38cd2057f4ab039dd33a272f3e32bcba210b06a01e7fc25f76177eb86b2abfd9474c14930ad158169f251f8a0c63d0c79dbffbe93c88edd41b9d6c0a6dd1106bbcb18741dbe675926256523048bd693bf64d3e88d913b649fee9acb76bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00036920d35e95852723875fc3ed16432a4e69a6a73877afbaa451d9ddea6ed8d07c5c5226ef77420c69652fd16917a6fc3b6e976144bd287857683d188615bd096f0854e04dc71f200b8e012983929c06f7aa1dcd80971ca176c9f520b78d88526bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c005cca79e2c9b6b942b48c4d152bf10465daaa1dbe802a3078175d39fbdb34d2c7dccb76a10d93c8cacec3960acb413f9153a8f6ca7ae20d70d4910ff81042510f70474d9028d0350674f9e71250ccc9d32740f7ea85213cde5a8c27f65eff2ade6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00a136eb7833c124bd0ed288b269341c423602c054f89d8fd8d0c9d2cd692e7fa5b4e0a63225a058ff091236a94a28a6bc5033de3523d8632337efb47c23e3890a70c35f53feed991c9307f1f2f1b10937f715f22ec4865857c2247fd08a7db4c66bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c000b64a3646d5c4d87a14a69fcbec07899ece09468f25f8e4943367e564c7923c8bf89b56b72fa26f0529652b4a8f2cba40d5492f6f20ad42e69b8748d449f3c06714e26888e679f94632695030e0c487cfd7ff550e78da6f44a42ad2d460460856bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c000d98ad18cec1c35b60b158deba7d3b81d4dcf4650600ca6a53eea174f9af44dfd28b8452b7249ac18fd0ffa7b82d254c58a75a0d6dcf85922efcc16a1788ba04740ddd8829263d40081cf49550918179b533b58026541a2b03eecd0c41f73daa6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0071815ef68b4dfe8038f11d5381d3e21b98678d71a3f4d57f640e3325ce6bdf8e7b714aa9a1e3e2ae255676788d8c0c0602731780a0e1e8d6ebde37c58070c20f846cc4009b4cadad268cd2cd6d910e4192e3e0e092a8954469380e09b0dd85dc6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c007aa8107fc9639b5a06a1df74223efb659d9de6eee2dfebab743cb834f11a92818a86d4651e428b2a918ef653db8f4892b4d80e09410a857ba5507ea6f42c810187ac4220ceb8cdd413d12e5c787895f098e821791fdb986984671ff3d39cd44b6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00e5e620de3a6b80c72214176bc1942eba083f0204782db4b2534315f6713c94d720cd5896e10da6a13feb2a12eb6c5e91645bf116af62197f6ddbb7b58c49bf008b07a85725c8e93c86a324b710d5fc1cd95d192aef5070e2be44cd873f488f776bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c002fe88f46468c33fa4cfb44865cc6ff10ef24f0b1c238fe82bf4a2229294d381c5eb2de43356c5f3465fb0f2a9db59699276fa1f9007786276cbe826ce3904d04905992e0060864d0b5c5d4534cc4c6a015266676391e37186f236a3d48c02c356bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c007d9453d52578d5ddbc4d9dadd0b24ebfc3da727039b30848b41f185b367b7712d93788d158264695935a99e55b60d26226deee26ce4badf02480d383549e360d9bd818fb112faa4d982dad41472236b681f2d84fbe56d1a81120cf459230adc36bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0044fed95ea21123dc4de366c443d47082d7280ec7d29d3ef5b474fba20dc3b93d90a11895a5abfc22f207f19389708bff5eb1d720c2a6d868c0e389fcf717580a9cb84477ebefdd278e7317829a2c2e8cabc29626e5dbe2082618b98ae336bc1e6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0043100489d1cd9d7da20c87ba34c41604b655346262cbd28269fa02f0cad5de0fcf3377c397f7c0153d3e97ddf99a26e849e2cf0cadfa2c4bc3bf7f39c7cbf1089dd71c663c2109bcc52522636d4f514eeda7487eca18f0f760c4dd6b63aa8ca46bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00b07cd67b06d0e1ea1ff544bbeed3436828dfe5a77bfa52404276ed4f49d6c68dab021954a8818b1ab6860b6ed4bed50a3421b00a9405938e8e1514eb8545aa0f9fc299a08d9f744444ff82d88967f9848db69237957eb9ddb27965337dc8e4ee6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c007bb849be38b4428a739d9f05caf700722b76f709eeada6a538e30a1e649ef3a221a3a106ea40025c0832d534886c2990e9c0f4eb9a4aa519d4871efde7922801a81e6ca07821e2ce2d903d7dcee4c4ae6f16b3b8a0c8f80683ab6ebbea48e94a6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0029312f401da7ecb4ac500c1814384164b9455288db3b1032c0b025546cbcb7618c4a9fc9900e8553632871dc0e08364c367d7de9084ab3c3cae5b74cfb524a00b12be4dc2ed56f14126e105367330a2f34d46dc8f477c9c527d529ac873e57906bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c004b652a6aed6aa75282375e32c23c37c98143b8a979f2b057f102a48d3041deae2501675b5afddfae5ad15629641533ee0011db2a4f5485b4396aa20450c5be0eb86f898a022046f0d4bef1b5484e3bb9500c0f0f207813cdf14d91b198a8d8316bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00d14503188410eac2c86048e919f4c2111f36b2a2567f35c932107b76e72da80a4588c6407484d9fe255e97112dd3baafceb2b98b3c352801cbb8daa8317dc802d711002fcecba2b011f06e0724f26f1a4ef2c6a6f68f552809fc3fc03da2eb5e6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c004a54b799e632c1a472ff8f2d42c8d766655bdba1357070a98554944ee05753ac2a5ec74aefb156f94373d61d697d9fedacd785931a6eeb4ca50dfdae3b3e450fd8624e624e2b16d281af9bc0d75a0ca26371ce6beeab84e2fc8879b688c44bae6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00a596ee86bcd3990adef2072a84bb9f447552bcca28ac4631168faf56c5b8100ce4f56253e0ee0c3c11010df575ea818eaa67941d8fcdb86ee72a753d520b4503db59ac8413c7d8fe851b8916a9f3310f7a7215e2e96102f26bdc0b7eee1fd5566bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c005100c37ed6c43892e46534dc607a564f986d34e01d4b6297083e5c87d3bede79541b18d5bacbec864c0fbc3aece2c5dab2299fc72b0b33a9b105485bdb51930ce10e877c86d53ee84e6f26b530930d9f48d5205b81bdd5c5bd34ba79ef4b653b6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00e63c91d5520f17e012d0a2fa048a0e7cc69410d0d7d62c6e36634a762a8c18d05141490293e204cba8ddb0021905dd26a92d979272729b2f446b3f4b4a244d01e1a6014868a9d66af359136eb9c81a919ae4bf90107587a8b70cc762354dec9e6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0079fdab4d3c72ecc687e83e6523b3a63af4f07ba21a078cae3acee92b47f9af58fdbcf25b07bbe1592e82409adeb100797623e3814c30ca48d8bebbba1af88b08e1b68fbd84333e31486c08e6153d9a1415b2e7e71b413702b7d64e9b631184a16bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0068e3fd2df86e9aaf0ab2f49c833084df75ffdd87d20be750a78b4ac53291265f66730bac488db55febe29512664ebf68685d2ff0c47e05507a3ccefc21ea9c03eab627f852966a198ca33a972db5295cf3047efce1f77595f331c6d03f38d4376bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c00af58572dfbedb2de298331577df49b6a90f46c390d6dddc30ac723524239e583303af224c4a3e2ba813c5766bbfec8e97d95a16cd5e7772851d0a669a0d55203ec68532131d9ba1c9863dbeeb28b445dc9fd719bfd725dbbc31d230e1fb704896bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c003fe0dcf565de6f8240f830a179911b1e23c4298720f23caebe66eeac8586b65c91fd26337669f3dba8fe4f5f6ce28df1293d3c9a99e45ccaa4aafbc9ea17e00cf6bd1895d053dfbb11036c2fe689fb2b1303ba96e336181ed92f4fbc997a45246bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0071ed2368351c512bcea63672a9f669690378bab5b532e68f8b05824e667dd3c8043ff9d28d3d8d85191e6e15a24eece17f384d12e8b7c4f4f983379fa7c4e50afd027d8abe86c507440cb39c489d2c6e252afe7de21974df8307f595e7de842f6bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c004d9463a4952c88d7d9fafbb00ecb951f8fef3491de4580ebe853e5bf5cd111fe34f6fd7071cc50e183a645a5bfa12c7e6e5cdc6b256fa4f1256b4687ecb8be04fe9a5f4c0113b52239b6ddb4828684a96847707a57c8079c27451de5bcae49196bdd7ae0356bc229bbe11a177e4f8c6b943ea712295c7ad7d94e5a52301099d73c840c0079e8f602b45728c12cba7b227a4fb8a7e9449f6ec299aa2042be2bdfa6c140fda370bc6f9f8e967684faac45b16e82deb3c2181aeda367e99bf9ca05cd549503fef60d18a9050c199cfd5d634798735306851774a261f999af63fd85136c228a00").to_vec();
    let justification =  GrandpaJustification::<Header>::decode(&mut &*hex)
        .unwrap();

    println!("{:?}", justification);
    println!("Round: {:?}", justification.round);
    
    let authorities_set_id: u64 = 1463; // queried via polkadot-ui (grandpa -> currentSetId)

    for signed in &justification.commit.precommits {

        if sp_finality_grandpa::check_message_signature(
            &finality_grandpa::Message::Precommit(signed.precommit.clone()),
            &signed.id,
            &signed.signature,
            justification.round,
            authorities_set_id,
        ) {
            println!("Signature Valid!")
        } else {
            println!("Error::InvalidSignature");
        }
    }
}